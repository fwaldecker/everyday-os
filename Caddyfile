{
    email {$LETSENCRYPT_EMAIL}
    # Enable automatic HTTPS for production
    # acme_ca https://acme-v02.api.letsencrypt.org/directory
}

# Security headers snippet
(security_headers) {
    header {
        # Prevent MIME type sniffing
        X-Content-Type-Options "nosniff"
        
        # Clickjacking protection
        X-Frame-Options "DENY"
        
        # XSS protection
        X-XSS-Protection "1; mode=block"
        
        # Referrer Policy
        Referrer-Policy "strict-origin-when-cross-origin"
        
        # Permissions Policy
        Permissions-Policy "accelerometer=(), camera=(), geolocation=(), gyroscope=(), magnetometer=(), microphone=(), payment=(), usb=()"
        
        # Remove Server header
        -Server
    }
}

# N8N - Workflow Automation with 5GB buffer support
n8n.{$BASE_DOMAIN} {
    import security_headers
    
    reverse_proxy n8n:5678 {
        header_up Host {host}
        header_up X-Real-IP {remote_host}
        header_up X-Forwarded-For {remote_host}
        header_up X-Forwarded-Proto {scheme}
        
        # IMPORTANT: 5GB buffer settings for large file handling
        transport http {
            read_timeout 2h
            write_timeout 2h
            dial_timeout 2h
            response_header_timeout 2h
        }
    }
}

# MinIO Console
minio-console.{$BASE_DOMAIN} {
    import security_headers
    
    # MinIO Console specific headers
    header X-Content-Type-Options "nosniff"
    header X-XSS-Protection "1; mode=block"
    
    reverse_proxy minio:9001 {
        header_up Host {host}
        header_up X-Real-IP {remote_host}
        header_up X-Forwarded-For {remote_host}
        header_up X-Forwarded-Proto {scheme}
    }
}

# MinIO API
minio-api.{$BASE_DOMAIN} {
    import security_headers
    
    # MinIO API specific headers
    header X-Content-Type-Options "nosniff"
    
    reverse_proxy minio:9000 {
        header_up Host {host}
        header_up X-Real-IP {remote_host}
        header_up X-Forwarded-For {remote_host}
        header_up X-Forwarded-Proto {scheme}
    }
}

# NCA Toolkit - Document and Video Processing
nca.{$BASE_DOMAIN} {
    import security_headers
    
    reverse_proxy nca-toolkit:8080 {
        header_up Host {host}
        header_up X-Real-IP {remote_host}
        header_up X-Forwarded-For {remote_host}
        header_up X-Forwarded-Proto {scheme}
    }
}